<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>약속 잡기</title>
<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Black+Han+Sans&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f0f13;
    --surface: #1a1a22;
    --surface2: #22222e;
    --border: #2e2e3e;
    --text: #e8e8f0;
    --text-muted: #7070a0;
    --accent: #7c6af7;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Gowun Dodum', sans-serif;
    min-height: 100vh;
    padding: 32px 20px;
    background-image: radial-gradient(ellipse at 20% 50%, rgba(124,106,247,0.08) 0%, transparent 60%),
                      radial-gradient(ellipse at 80% 20%, rgba(247,106,138,0.06) 0%, transparent 50%);
  }

  h1 {
    font-family: 'Black Han Sans', sans-serif;
    font-size: 2rem;
    letter-spacing: -0.02em;
    margin-bottom: 4px;
    background: linear-gradient(135deg, #e8e8f0, #7c6af7);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .subtitle { color: var(--text-muted); font-size: 0.85rem; margin-bottom: 32px; }

  .setup-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    max-width: 480px;
    margin-bottom: 32px;
  }

  .section-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  .setup-row { display: flex; gap: 10px; align-items: center; }

  .setup-input {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-family: 'Gowun Dodum', sans-serif;
    font-size: 1.2rem;
    padding: 10px 16px;
    width: 90px;
    text-align: center;
    outline: none;
    transition: border-color 0.2s;
  }
  .setup-input:focus { border-color: var(--accent); }

  .btn {
    background: var(--accent);
    border: none;
    border-radius: 10px;
    color: #fff;
    cursor: pointer;
    font-family: 'Gowun Dodum', sans-serif;
    font-size: 0.9rem;
    padding: 10px 20px;
    transition: opacity 0.2s, transform 0.1s;
  }
  .btn:hover { opacity: 0.85; }
  .btn:active { transform: scale(0.97); }

  .main { display: flex; gap: 24px; flex-wrap: wrap; align-items: flex-start; }

  /* --- Chips Panel --- */
  .chips-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    min-width: 178px;
    flex-shrink: 0;
  }

  .chip {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 12px;
    border-radius: 10px;
    cursor: pointer;
    border: 2px solid transparent;
    margin-bottom: 6px;
    transition: background 0.15s, border-color 0.15s;
  }
  .chip:hover { background: var(--surface2); }
  .chip.active { border-color: currentColor; background: var(--surface2); }

  .chip-dot {
    width: 18px; height: 18px;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 8px currentColor;
  }

  .chip-name {
    font-size: 0.85rem;
    font-family: 'Gowun Dodum', sans-serif;
    background: none;
    border: none;
    border-bottom: 1px solid transparent;
    color: inherit;
    outline: none;
    width: 100%;
    cursor: text;
    padding: 1px 0;
    transition: border-color 0.2s;
    min-width: 0;
  }
  .chip-name:focus { border-bottom-color: currentColor; }

  /* --- Calendar Panel --- */
  .calendar-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    flex: 1;
    min-width: 340px;
  }

  .cal-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .cal-nav button {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    cursor: pointer;
    font-size: 1rem;
    padding: 6px 14px;
    transition: background 0.15s;
  }
  .cal-nav button:hover { background: var(--border); }

  .cal-month {
    font-family: 'Black Han Sans', sans-serif;
    font-size: 1.1rem;
  }

  .cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
  }

  .cal-dow {
    text-align: center;
    font-size: 0.7rem;
    color: var(--text-muted);
    padding: 4px 0 8px;
    letter-spacing: 0.04em;
  }
  .cal-dow:first-child { color: #f76a8a; }
  .cal-dow:last-child  { color: #6ab4f7; }

  .cal-day {
    position: relative;
    aspect-ratio: 1;
    min-height: 50px;
    border-radius: 10px;
    cursor: pointer;
    overflow: hidden;
  }
  .cal-day.empty { pointer-events: none; }
  .cal-day:not(.empty):hover::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 10px;
    border: 1.5px solid rgba(255,255,255,0.15);
    pointer-events: none;
    z-index: 2;
  }

  .day-bg {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    border-radius: 10px;
    overflow: hidden;
    pointer-events: none;
  }

  .day-stripe {
    flex: 1;
    opacity: 0.4;
  }

  .day-num {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.84rem;
    font-weight: bold;
    z-index: 1;
    pointer-events: none;
    text-shadow: 0 1px 4px rgba(0,0,0,0.7);
  }

  /* --- Summary Panel --- */
  .summary-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    min-width: 230px;
    flex-shrink: 0;
    max-width: 270px;
  }

  .summary-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .btn-analyze {
    background: linear-gradient(135deg, #7c6af7, #f76a8a);
    border: none;
    border-radius: 8px;
    color: #fff;
    cursor: pointer;
    font-family: 'Gowun Dodum', sans-serif;
    font-size: 0.78rem;
    padding: 6px 12px;
    transition: opacity 0.2s, transform 0.1s;
    white-space: nowrap;
  }
  .btn-analyze:hover { opacity: 0.85; }
  .btn-analyze:active { transform: scale(0.96); }

  .analyze-hint {
    color: var(--text-muted);
    font-size: 0.8rem;
    text-align: center;
    line-height: 1.7;
    padding: 20px 0;
  }

  .summary-body { display: none; }
  .summary-body.visible { display: block; }

  .summary-section { margin-bottom: 14px; }

  .badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 20px;
    font-size: 0.72rem;
    margin-bottom: 8px;
  }
  .badge-green  { background: rgba(72,199,142,0.18); color: #48c78e; }
  .badge-yellow { background: rgba(247,183,49,0.18);  color: #f7b731; }
  .badge-red    { background: rgba(247,106,138,0.18); color: #f76a8a; }

  .summary-date {
    background: var(--surface2);
    border-radius: 8px;
    padding: 7px 10px;
    margin-bottom: 4px;
    font-size: 0.8rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
  }

  .sum-chips { display: flex; gap: 3px; flex-wrap: wrap; }

  .sum-chip {
    width: 10px; height: 10px;
    border-radius: 3px;
  }

  .no-data { color: var(--text-muted); font-size: 0.8rem; font-style: italic; }

  .hidden { display: none; }
</style>
</head>
<body>

<h1>약속 잡기</h1>
<p class="subtitle">모두의 스케줄을 한눈에 — 최적의 날을 찾아보세요</p>

<!-- Setup -->
<div class="setup-card">
  <div class="section-label">총 인원 설정</div>
  <div class="setup-row">
    <input type="number" class="setup-input" id="countInput" min="2" max="10" value="3">
    <span style="color:var(--text-muted);font-size:0.9rem;">명</span>
    <button class="btn" onclick="initChips()">시작하기</button>
  </div>
</div>

<!-- Main -->
<div class="main hidden" id="mainArea">

  <!-- Chips -->
  <div class="chips-panel">
    <div class="section-label">참여자</div>
    <div id="chipsContainer"></div>
  </div>

  <!-- Calendar -->
  <div class="calendar-panel">
    <div class="cal-nav">
      <button onclick="changeMonth(-1)">&#8249;</button>
      <div class="cal-month" id="calMonth"></div>
      <button onclick="changeMonth(1)">&#8250;</button>
    </div>
    <div class="cal-grid" id="calGrid"></div>
  </div>

  <!-- Summary -->
  <div class="summary-panel">
    <div class="summary-header">
      <div class="section-label" style="margin-bottom:0">날짜 분석</div>
      <button class="btn-analyze" id="btnAnalyze" onclick="runAnalysis()">✦ 분석하기</button>
    </div>
    <div class="analyze-hint" id="analyzeHint">분석 버튼을 눌러<br>결과를 확인하세요</div>
    <div class="summary-body" id="summaryBody">
      <div class="summary-section">
        <div><span class="badge badge-green">모두 가능</span></div>
        <div id="sumAll"></div>
      </div>
      <div class="summary-section">
        <div><span class="badge badge-yellow">1명 불가</span></div>
        <div id="sum1"></div>
      </div>
      <div class="summary-section">
        <div><span class="badge badge-red">2명 불가</span></div>
        <div id="sum2"></div>
      </div>
    </div>
  </div>

</div>

<script>
const PALETTE = [
  '#f76a8a','#f7b731','#48c78e','#7c6af7','#f76af7',
  '#6af7f7','#f79e6a','#6ab4f7','#c7f76a','#f7a76a'
];
const NAMES = ['A','B','C','D','E','F','G','H','I','J'];

let chips = [];
let activeChip = null;
// dateData[key] = Set of chipIds marked unavailable
let dateData = {};
let currentYear, currentMonth;

function initChips() {
  const n = Math.max(2, Math.min(10, parseInt(document.getElementById('countInput').value) || 3));
  chips = Array.from({length: n}, (_, i) => ({ id: i, name: `참여자 ${NAMES[i]}`, color: PALETTE[i] }));
  activeChip = chips[0];
  dateData = {};
  currentYear = new Date().getFullYear();
  currentMonth = new Date().getMonth();
  document.getElementById('mainArea').classList.remove('hidden');
  document.getElementById('analyzeHint').style.display = 'block';
  document.getElementById('summaryBody').classList.remove('visible');
  renderChips();
  renderCalendar();
}

function renderChips() {
  document.getElementById('chipsContainer').innerHTML = chips.map(chip => `
    <div class="chip ${chip.id === activeChip?.id ? 'active' : ''}"
         style="color:${chip.color}"
         onclick="selectChip(${chip.id})">
      <div class="chip-dot" style="background:${chip.color}"></div>
      <input
        class="chip-name"
        type="text"
        value="${chip.name}"
        onclick="event.stopPropagation()"
        oninput="renameChip(${chip.id}, this.value)"
      >
    </div>
  `).join('');
}

function renameChip(id, value) {
  const chip = chips.find(c => c.id === id);
  if (chip) chip.name = value;
}

function selectChip(id) {
  activeChip = chips.find(c => c.id === id);
  renderChips();
}

function changeMonth(d) {
  currentMonth += d;
  if (currentMonth > 11) { currentMonth = 0; currentYear++; }
  if (currentMonth < 0)  { currentMonth = 11; currentYear--; }
  renderCalendar();
}

function renderCalendar() {
  const months = ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'];
  document.getElementById('calMonth').textContent = `${currentYear}년 ${months[currentMonth]}`;

  const firstDay    = new Date(currentYear, currentMonth, 1).getDay();
  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
  const dows = ['일','월','화','수','목','금','토'];

  let html = dows.map(d => `<div class="cal-dow">${d}</div>`).join('');
  for (let i = 0; i < firstDay; i++) html += `<div class="cal-day empty"></div>`;

  for (let d = 1; d <= daysInMonth; d++) {
    const key = `${currentYear}-${currentMonth+1}-${d}`;
    const marked = dateData[key] || new Set();

    let bgHtml = '';
    if (marked.size > 0) {
      const stripes = chips
        .filter(ch => marked.has(ch.id))
        .map(ch => `<div class="day-stripe" style="background:${ch.color}"></div>`)
        .join('');
      bgHtml = `<div class="day-bg">${stripes}</div>`;
    }

    html += `<div class="cal-day" onclick="toggleDate(${d})">
      ${bgHtml}
      <div class="day-num">${d}</div>
    </div>`;
  }

  document.getElementById('calGrid').innerHTML = html;
}

function toggleDate(d) {
  if (!activeChip) return;
  const key = `${currentYear}-${currentMonth+1}-${d}`;
  if (!dateData[key]) dateData[key] = new Set();
  if (dateData[key].has(activeChip.id)) {
    dateData[key].delete(activeChip.id);
    if (dateData[key].size === 0) delete dateData[key];
  } else {
    dateData[key].add(activeChip.id);
  }
  renderCalendar();
}

/* ---- Analysis ---- */
function runAnalysis() {
  const all = [], one = [], two = [];

  for (const key of Object.keys(dateData)) {
    const marked = dateData[key];
    const unavail = marked.size;
    if (unavail === 0)      all.push({ key, marked });
    else if (unavail === 1) one.push({ key, marked });
    else if (unavail === 2) two.push({ key, marked });
  }

  const sortByDate = arr => arr.sort((a, b) => {
    const n = k => { const [y,m,d] = k.split('-'); return y*10000+parseInt(m)*100+parseInt(d); };
    return n(a.key) - n(b.key);
  });

  renderSumSection('sumAll', sortByDate(all));
  renderSumSection('sum1',   sortByDate(one));
  renderSumSection('sum2',   sortByDate(two));

  document.getElementById('analyzeHint').style.display = 'none';
  document.getElementById('summaryBody').classList.add('visible');

  const btn = document.getElementById('btnAnalyze');
  btn.textContent = '✓ 완료';
  setTimeout(() => { btn.textContent = '✦ 분석하기'; }, 1400);
}

function formatKey(key) {
  const [y, m, d] = key.split('-');
  const date = new Date(y, m-1, d);
  const dows = ['일','월','화','수','목','금','토'];
  return `${m}/${d} (${dows[date.getDay()]})`;
}

function renderSumSection(id, items) {
  const el = document.getElementById(id);
  if (!items.length) { el.innerHTML = `<div class="no-data">해당 없음</div>`; return; }
  el.innerHTML = items.map(({ key, marked }) => {
    const chipsHtml = chips.map(chip => {
      const isUnavail = marked.has(chip.id);
      const style = isUnavail
        ? `background:transparent;border:2px solid ${chip.color};opacity:0.7;`
        : `background:${chip.color};`;
      return `<div class="sum-chip" title="${chip.name}" style="${style}"></div>`;
    }).join('');
    return `<div class="summary-date">
      <span>${formatKey(key)}</span>
      <div class="sum-chips">${chipsHtml}</div>
    </div>`;
  }).join('');
}

// Boot
initChips();
</script>
</body>
</html>
